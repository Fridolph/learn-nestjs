# 日志

- 常见日志及获取（记录）方式
- 第三方日志方案
  - winston （推荐劳模）全面、稳定
  - pino （推荐懒人）轻量、快速
- 通用业务系统日志系统配置（学习定时任务）

## 日志需要怎么定位问题

- 什么时间发生的
- 发生了什么事情
- 错误是什么

## 日志等级

- Log 通用日志，按需进行记录（打印）
- Warning 警告日志，如：尝试多次进行数据库操作
- Error 错误日志，如：数据库连接失败
- Debug 调试日志，如：加载数据日志
- Verbose 详细日志，所有的操作及详细信息（非必要不打印）

## 按功能分类

- 错误日志 -> 方便定位问题，给用户友好提示
- 调试日志 -> 方便开发
- 请求日志 -> 记录敏感行为

## 日志记录位置

- 控制台日志 -> 方便监看（调试用）
- 文件日志 -> 方便回溯与追踪（24小时滚动）
- 数据库日志 -> 敏感操作、敏感数据日志

## 在NestJS中记录日志

推荐

| -       | Log     | Error   | Warning      | Debug        | Verbose | API     |
| ------- | ------- | ------- | ------------ | ------------ | ------- | ------- |
| Dev     | ✔️      | ✔️      | ✔️           | ✔️           | ✔️      | ✔️      |
| Staging | ✔️      | ✔️      | ✔️           | ✔️           | ✔️      | ✔️      |
| Prod    | ✔️      | ✔️      | ❌           | ❌           | ❌      | ✔️      |
| 位置    | console | 文件/DB | console/文件 | console/文件 | console | 文件/DB |

### 内置异常

<https://docs.nestjs.cn/9/exceptionfilters>